class MPCardForm{TIMEOUT_TO_WAIT_CHECKOUT_AMOUNT_LOAD=2500;constructor(){this.form=null,this.formMounted=!1,this.mpFormId="checkout"}initCardForm(e=this.getAmount()){if(this.shouldCreateLoadSpinner()&&this.createLoadSpinner(),!window.mpSdkInstance){const e=new MercadoPago(wc_mercadopago_custom_checkout_params.public_key,{locale:wc_mercadopago_custom_checkout_params.locale});window.mpSdkInstance=e}return new Promise(((r,o)=>{this.form=window.mpSdkInstance.cardForm({amount:e,iframe:!0,form:this.getCardFormConfig(),callbacks:this.getCardFormCallbacks(r,o)})})).then((()=>{this.sendMetric("MP_CARDFORM_SUCCESS","Security fields loaded","mp_custom_checkout_security_fields_client")})).catch((e=>{const r=this.handleCardFormErrors(e);this.sendMetric("MP_CARDFORM_ERROR",r,"mp_custom_checkout_security_fields_client"),this.removeLoadSpinner(),console.error("Mercado Pago cardForm error: ",r)}))}getCardFormConfig(){return{id:this.mpFormId,cardNumber:{id:"form-checkout__cardNumber-container",placeholder:"0000 0000 0000 0000",style:{"font-size":"16px",height:"48px",padding:"14px"}},cardholderName:{id:"form-checkout__cardholderName",placeholder:wc_mercadopago_custom_checkout_params.placeholders.cardholderName},cardExpirationDate:{id:"form-checkout__expirationDate-container",placeholder:wc_mercadopago_custom_checkout_params.placeholders.cardExpirationDate,mode:"short",style:{"font-size":"16px",height:"48px",padding:"14px"}},securityCode:{id:"form-checkout__securityCode-container",placeholder:wc_mercadopago_custom_card_form_params.security_code_placeholder_text_3_digits,style:{"font-size":"16px",height:"48px",padding:"14px"}},identificationType:{id:"form-checkout__identificationType"},identificationNumber:{id:"form-checkout__identificationNumber"},issuer:{id:"form-checkout__issuer",placeholder:wc_mercadopago_custom_checkout_params.placeholders.issuer},installments:{id:"form-checkout__installments",placeholder:wc_mercadopago_custom_checkout_params.placeholders.installments}}}getCardFormCallbacks(e,r){return{onReady:r=>{"undefined"!=typeof MPCheckoutFieldsDispatcher&&MPCheckoutFieldsDispatcher.addEventListenerDispatcher(r?.cardNumber,"blur","card_number_filled",{isUsingCardForm:!0}),this.shouldCreateLoadSpinner()?setTimeout((()=>{window.mpSuperTokenTriggerHandler?.loadSuperToken(),this.removeLoadSpinner(),e()}),this.TIMEOUT_TO_WAIT_CHECKOUT_AMOUNT_LOAD):setTimeout((()=>{window.mpSuperTokenTriggerHandler?.loadSuperToken(),e()}),200)},onFormMounted:e=>{this.formMounted=!0,e&&console.log("Callback to handle the error: creating the CardForm",e)},onFormUnmounted:e=>{this.formMounted=!1,CheckoutPage.clearInputs(),e&&console.log("Callback to handle the error: unmounting the CardForm",e)},onInstallmentsReceived:(e,r)=>{if(e){const r=wc_mercadopago_custom_checkout_params.error_messages;return this.addErrorAlert(r.installments[e.message]??r.default),void console.warn("Installments handling error: ",e)}CheckoutPage.setChangeEventOnInstallments(r)},onCardTokenReceived:e=>{e&&console.error("Token handling error: ",e)},onPaymentMethodsReceived:(e,r)=>{if(e)console.error("Payment methods handling error: ",e);else try{if(r){CheckoutPage.clearInputs();const e=r[0];CheckoutPage.setValueOn("paymentMethodId",e.id),CheckoutPage.setCvvConfig(e.settings[0].security_code),CheckoutPage.setImageCard(e.secure_thumbnail||e.thumbnail);const o=CheckoutPage.loadAdditionalInfo(e.additional_info_needed);CheckoutPage.additionalInfoHandler(o),CheckoutPage.setDisplayOfError("fcCardNumberContainer","remove","mp-error"),CheckoutPage.setDisplayOfInputHelper("mp-card-number","none"),CheckoutPage.shouldEnableInstallmentsComponent(e.payment_type_id)}else CheckoutPage.setDisplayOfError("fcCardNumberContainer","add","mp-error"),CheckoutPage.setDisplayOfInputHelper("mp-card-number","flex")}catch(e){if(e)return void console.error("Payment methods handling error: ",e);CheckoutPage.setDisplayOfError("fcCardNumberContainer","add","mp-error"),CheckoutPage.setDisplayOfInputHelper("mp-card-number","flex")}},onSubmit:e=>{e.preventDefault()},onValidityChange:(e,r)=>{if(e){this.removeLoadSpinner();let o=CheckoutPage.getHelperMessage(r),t=wc_mercadopago_custom_checkout_params.input_helper_message[r][e[0].code];o.innerHTML=t||wc_mercadopago_custom_checkout_params.input_helper_message[r].invalid_length,"cardNumber"===r&&"invalid_length"!==e[0].code&&(CheckoutPage.setBackground("fcCardNumberContainer","no-repeat #fff"),CheckoutPage.removeAdditionFields(),CheckoutPage.clearInputs());let a=CheckoutPage.findContainerField(r);return CheckoutPage.setDisplayOfError(a,"add","mp-error"),CheckoutPage.setDisplayOfInputHelper(CheckoutPage.inputHelperName(r),"flex")}let o=CheckoutPage.findContainerField(r);return CheckoutPage.setDisplayOfError(o,"removed","mp-error"),CheckoutPage.setDisplayOfInputHelper(CheckoutPage.inputHelperName(r),"none")},onError:e=>{this.removeLoadSpinner(),CheckoutPage.verifyCardholderName(),CheckoutPage.verifyInstallmentsContainer(),e.forEach((e=>(this.removeBlockOverlay(),e.message.includes("timed out")?r(e):e.message.includes("cardNumber")?(CheckoutPage.setDisplayOfError("fcCardNumberContainer","add","mp-error"),CheckoutPage.setDisplayOfInputHelper("mp-card-number","flex")):e.message.includes("cardholderName")?(CheckoutPage.setDisplayOfError("fcCardholderName","add","mp-error"),CheckoutPage.setDisplayOfInputHelper("mp-card-holder-name","flex")):e.message.includes("expirationMonth")||e.message.includes("expirationYear")?(CheckoutPage.setDisplayOfError("fcCardExpirationDateContainer","add","mp-error"),CheckoutPage.setDisplayOfInputHelper("mp-expiration-date","flex")):e.message.includes("securityCode")?(e.message.includes("should be a number")||e.message.includes("should be of length")?CheckoutPage.setDisplayOfInputHelperMessage("mp-security-code",wc_mercadopago_custom_checkout_params.input_helper_message.securityCode.invalid_length):CheckoutPage.setDisplayOfInputHelperMessage("mp-security-code",wc_mercadopago_custom_checkout_params.input_helper_message.securityCode.invalid_type),CheckoutPage.setDisplayOfError("fcSecurityNumberContainer","add","mp-error"),CheckoutPage.setDisplayOfInputHelper("mp-security-code","flex")):e.message.includes("identificationNumber")?(CheckoutPage.setDisplayOfError("fcIdentificationNumberContainer","add","mp-error"),CheckoutPage.setDisplayOfInputHelper("mp-doc-number","flex")):r(e))))}}}getAmount(){const e=parseFloat(document.getElementById("mp-amount").value.replace(",","."));return String(e)}handleCardFormErrors(e){if(e.length){const r=[];return e.forEach((e=>{r.push(e.description||e.message)})),r.join(",")}return e.description||e.message}sendMetric(e,r,o){void 0!==window.mPmetrics&&window.mPmetrics.push({action:e,label:r,target:o})}isSuperTokenPaymentMethodsLoaded(){return window.mpSuperTokenTriggerHandler?.isSuperTokenPaymentMethodsLoaded()||!1}isClassicCheckout(){return!!document.querySelector(".payment_method_woo-mercado-pago-custom")}isSuperTokenPaymentMethodsListRendered(){return!!document.querySelector(".mp-super-token-payment-methods-list")}shouldCreateLoadSpinner(){return!this.isSuperTokenPaymentMethodsListRendered()&&!this.isClassicCheckout()&&!this.isSuperTokenPaymentMethodsLoaded()}createLoadSpinner(){const e=document.querySelector(".mp-checkout-custom-container"),r=document.querySelector(".mp-checkout-custom-load");e&&(e.style.display="none"),r&&(r.style.display="flex")}removeLoadSpinner(){const e=document.querySelector(".mp-checkout-custom-container"),r=document.querySelector(".mp-checkout-custom-load");e&&(e.style.display="block"),r&&(r.style.display="none")}removeBlockOverlay(){jQuery("form#order_review").length>0&&jQuery(".blockOverlay").css("display","none")}addErrorAlert(e){this.removeElementsByClass("woocommerce-NoticeGroup-checkout"),jQuery(window.mpCheckoutForm).prepend(`\n            <div class="woocommerce-NoticeGroup woocommerce-NoticeGroup-checkout">\n                <ul class="woocommerce-error" role="alert">\n                    <li>${e}<li>\n                </ul>\n            </div>\n        `),window.scrollTo(0,0)}removeElementsByClass(e){const r=document.getElementsByClassName(e);for(;r.length>0;)r[0].parentNode.removeChild(r[0])}}