(()=>{"use strict";var e={20:(e,t,o)=>{var r=o(609),n=Symbol.for("react.element"),a=(Symbol.for("react.fragment"),Object.prototype.hasOwnProperty),c=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function i(e,t,o){var r,i={},u=null,d=null;for(r in void 0!==o&&(u=""+o),void 0!==t.key&&(u=""+t.key),void 0!==t.ref&&(d=t.ref),t)a.call(t,r)&&!s.hasOwnProperty(r)&&(i[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===i[r]&&(i[r]=t[r]);return{$$typeof:n,type:e,key:u,ref:d,props:i,_owner:c.current}}t.jsx=i,t.jsxs=i},609:e=>{e.exports=window.React},848:(e,t,o)=>{e.exports=o(20)}},t={};const o=window.wc.wcBlocksRegistry,r=window.wc.wcSettings,n=window.wp.element,a=window.wp.htmlEntities,c="mercadopago_blocks_update_cart",s=(e,t)=>e({namespace:c,data:{action:"add",gateway:t}});const i=window.wc.wcBlocksData,u=window.wp.data;var d=function o(r){var n=t[r];if(void 0!==n)return n.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,o),a.exports}(848);const m=({text:e,imgSrc:t,id:o})=>(0,d.jsxs)("div",{id:o,className:"row-image-select",children:[(0,d.jsx)("img",{src:t}),(0,d.jsx)("span",{children:e})]});var p;const l="mp_checkout_blocks",w="woo-mercado-pago-custom",_=(0,r.getSetting)("woo-mercado-pago-custom_data",{}),y=(0,a.decodeEntities)(_.title)||"Checkout Custom",S=()=>{const e=(0,a.decodeEntities)(_?.params?.fee_title||""),t=`${y} ${e}`;return(0,d.jsx)(m,{text:t,imgSrc:_.params.icon})},f=e=>{const{eventRegistration:t,emitResponse:o,onSubmit:r}=e,{onPaymentSetup:a,onCheckoutSuccess:m,onCheckoutFail:p}=t,[y,S]=(0,n.useState)(null),{extensionCartUpdate:f}=wc.blocksCheckout;return(0,n.useEffect)((()=>(s(f,w).then((e=>{S(e?.totals?.total_price)})).catch((e=>{console.error(e)})),()=>(((e,t)=>{e({namespace:c,data:{action:"remove",gateway:t}})})(f,w),a((()=>({type:o.responseTypes.SUCCESS})))()))),[a]),(0,n.useEffect)((()=>{e.billing.cartTotal.value==y?async function(e,t,o=1){try{for(window.mpCustomCheckoutHandler.cardForm.createLoadSpinner();!window.mpCustomCheckoutHandler;)await new Promise((e=>setTimeout(e,100)));const r=window.mpCustomCheckoutHandler,n=!!document.querySelector(".wc-block-components-spinner");r.cardForm.formMounted&&!n&&r.cardForm.form.unmount();let a=function(e,t){if(!Number.isInteger(e)||"object"!=typeof t)throw new Error("Invalid input");return(e/Math.pow(10,t.minorUnit)).toFixed(t.minorUnit).split(".").join(".")}(e,t);const c=parseFloat(o);c>0&&(a=String(parseFloat(a)*c)),await Promise.all([r.cardForm.initCardForm(a),window.mpSuperTokenTriggerHandler?.loadSuperToken(a)])}catch(e){"function"==typeof sendMetric&&sendMetric("error_to_update_cart_total",e?.message||"Unknown error","mp_cart_total_change_error")}finally{setTimeout((()=>mpCustomCheckoutHandler?.cardForm?.removeLoadSpinner()),500)}}(e.billing.cartTotal.value,e.billing.currency,_.params.currencyRatio):s(f,w).then((e=>{S(e?.totals?.total_price)})).catch((e=>{console.error(e)}))}),[e.billing.cartTotal.value,y]),(0,n.useEffect)((()=>{const e=a((async()=>{switch(window.mpSuperTokenPaymentMethods?.hideSuperTokenError(),document.querySelector("#mp_checkout_type")?.value){case"super_token":try{const e=window.mpSuperTokenPaymentMethods,t=window.mpSuperTokenAuthenticator,o=window.mpSuperTokenMetrics;if(!e)throw new Error(MPSuperTokenErrorCodes.SUPER_TOKEN_PAYMENT_METHODS_NOT_FOUND);if(!t)throw new Error(MPSuperTokenErrorCodes.SUPER_TOKEN_AUTHENTICATOR_NOT_FOUND);if(!o)throw new Error(MPSuperTokenErrorCodes.SUPER_TOKEN_METRICS_NOT_FOUND);o.registerClickOnPlaceOrderButton();const r=e.getActivePaymentMethod(),n=r&&e.isSelectedPaymentMethodValid();if(r&&!n&&e.forceShowValidationErrors(),(0,u.select)(i.VALIDATION_STORE_KEY).hasValidationErrors()){e.selectLastPaymentMethodChoosen();break}if(!r)throw new Error(MPSuperTokenErrorCodes.SELECT_PAYMENT_METHOD_ERROR);if(!n)throw new Error(MPSuperTokenErrorCodes.SELECT_PAYMENT_METHOD_NOT_VALID);await t.authorizePayment(r.token),await e.updateSecurityCode()}catch(e){return window.mpSuperTokenErrorHandler?.handleError(e),window.mpCustomCheckoutHandler.cardForm.removeLoadSpinner(),{type:o.responseTypes.ERROR}}break;case"wallet_button":break;default:try{const e=await window.mpCustomCheckoutHandler.cardForm.form.createCardToken();document.querySelector("#cardTokenId").value=e.token}catch(e){return console.warn("token creation error after submit: ",e),window.mpCustomCheckoutHandler.cardForm.removeLoadSpinner(),window.mpCustomCheckoutHandler.cardForm.scrollToCardForm(),{type:o.responseTypes.ERROR}}if("undefined"!=typeof CheckoutPage&&!CheckoutPage.verifyInstallmentsContainer())return window.mpCustomCheckoutHandler.cardForm.removeLoadSpinner(),{type:o.responseTypes.ERROR}}const e=document.querySelector("#mercadopago-utilities"),t={};e&&e.querySelectorAll("input[name]").forEach((e=>{t[e.name]=e.value}));const r=document.querySelector("#form-checkout__identificationType"),n=document.querySelector("#form-checkout__identificationNumber");return r&&r.value&&(t["mercadopago_custom[doc_type]"]=r.value),n&&n.value&&(t["mercadopago_custom[doc_number]"]=n.value),{type:o.responseTypes.SUCCESS,meta:{paymentMethodData:{...window.mpHiddenInputDataFromBlocksCheckout,...t}}}}));return()=>e()}),[a]),(0,n.useEffect)((()=>()=>{const e=window.mpSuperTokenPaymentMethods;e?.securityFieldsActiveInstance&&"function"==typeof e.unmountActiveSecurityCodeInstance&&e.unmountActiveSecurityCodeInstance();const t=window.mpCustomCheckoutHandler?.cardForm;t?.formMounted&&t?.form&&"function"==typeof t.form.unmount&&t.form.unmount()}),[]),(0,n.useEffect)((()=>{const e=m((async e=>{const t=e.processingResponse,r=e.processingResponse.paymentDetails;if(r.three_ds_flow){const e=new Promise(((e,t)=>{window.addEventListener("completed_3ds",(o=>{o.detail.error&&t(o.detail.error),e()}))}));return window.mpCustomCheckoutHandler.threeDSHandler.load3DSFlow(r.last_four_digits),await e.then((()=>({type:o.responseTypes.SUCCESS}))).catch((e=>({type:o.responseTypes.FAIL,message:e,messageContext:o.noticeContexts.PAYMENTS})))}return sendMetric("MP_CUSTOM_BLOCKS_SUCCESS",t.paymentStatus,l),{type:o.responseTypes.SUCCESS}}));return()=>e()}),[m]),(0,n.useEffect)((()=>{const e=p((e=>{"undefined"!=typeof MPCheckoutErrorDispatcher&&MPCheckoutErrorDispatcher.dispatchEventWhenBlocksCheckoutErrorOccurred(e),window.mpSuperTokenTriggerHandler?.resetSuperTokenOnError();const t=e.processingResponse;return sendMetric("MP_CUSTOM_BLOCKS_ERROR",t.paymentStatus,l),{type:o.responseTypes.FAIL,messageContext:o.noticeContexts.PAYMENTS,message:t.paymentDetails.message}}));return()=>e()}),[p]),(0,n.useEffect)((()=>{window.mpFormId="blocks_checkout_form",window.mpCheckoutForm=document.querySelector(".wc-block-components-form.wc-block-checkout__form"),window.mpCheckoutForm&&jQuery(window.mpCheckoutForm).prop("id",window.mpFormId);const e=document.getElementById("mp-wallet-button");e&&e.addEventListener("click",(e=>{e.preventDefault(),document.querySelector("#mp_checkout_type").value="wallet_button",r()}))}),[]),(0,d.jsx)("div",{dangerouslySetInnerHTML:{__html:_.params.content}})},h={name:w,label:(0,d.jsx)(S,{}),content:(0,d.jsx)(f,{}),edit:(0,d.jsx)(f,{}),canMakePayment:()=>!0,ariaLabel:y,supports:{features:null!==(p=_?.supports)&&void 0!==p?p:[]}};(0,o.registerPaymentMethod)(h)})();